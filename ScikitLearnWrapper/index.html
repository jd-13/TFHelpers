<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Scikit-learn Wrapper - TFHelpers</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Scikit-learn Wrapper";
    var mkdocs_page_input_path = "ScikitLearnWrapper.md";
    var mkdocs_page_url = "/ScikitLearnWrapper/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> TFHelpers</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Modules</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../SKTFModels/">SKTFModels</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Scikit-learn Wrapper</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#scikit-learn-wrapper">Scikit-learn Wrapper</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#tfregressor">TFRegressor</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../TrainingHelpers/">TrainingHelpers</a>
                </li>
                <li class="">
                    
    <a class="" href="../FilesAndLogging/">FilesAndLogging</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../ModelManager/">ModelManager</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">TFHelpers</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Modules &raquo;</li>
        
      
    
    <li>Scikit-learn Wrapper</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="scikit-learn-wrapper">Scikit-learn Wrapper</h1>
<p>TFHelpers provides a basic wrapper class which you can inherit from to create models which are
compatible with the scikit-learn api. Models which inherit from the <code>SKTFWrapper</code> class will be
compatible with scikit-learn functionality such as <code>GridSearchCV</code>, and will provide <code>fit</code> and
<code>predict</code> methods for training and producing predictions.</p>
<p>If you inherit from <code>SKTFWrapper</code> you will need to build the graph and implement the training loop
in the <code>fit</code> method. The <code>SciKitWrapper</code> module also contains child classes of <code>SKTFWrapper</code> which
provide further functionality. Currently only <code>TFRegressor</code> is available.</p>
<h2 id="tfregressor">TFRegressor</h2>
<p>If you wish to create a regression model you can inherit from the <code>TFRegressor</code> class which provides
a lot of functionality, leaving the methods <code>_buildGraph</code>, <code>_restoreGraph</code>, <code>_buildHyperParamsDict</code>,
and the constructor for you to implement.</p>
<p>Using <code>TFRegressor</code> gets you the following features for free:</p>
<ul>
<li>A fairly conventional training loop, with user specified batch size</li>
<li>Logging of training and validation losses to tensorboard on each epoch, as well as writing any <code>tf.Summary</code> nodes at each epoch</li>
<li>Saving the model at each epoch</li>
<li>Continuing training from previous runs</li>
<li>Saving all model and tensorboard related files in a directory structure sorted by model hyperparameters and start time</li>
<li>Early stopping</li>
<li>Predicted time to completion</li>
<li>Warnings if issues are detected during training such as: parts of the graph do not appear to be training, the loss is zero, or there is a risk of exploding gradients</li>
</ul>
<h3 id="implementation">Implementation</h3>
<pre><code>__init__(self,
        learningRate,
        batchSize,
        initializer,
        dropoutRate,
        restoreFrom,
        outputLength)
</code></pre>
<p>The <code>__init__</code> method should be overriden and used to set the hyperparameters for your own model,
and should call <code>TFRegressor.__init__</code> to provide the hyperparameters required by the <code>TFRegressor</code>.</p>
<p><em>NOTE: For compatitbility with scikit-learn functionality such as <code>GridSearchCV</code>, every parameter
passed to the constructor of your model must be saved to a member variable of exactly the same name.</em></p>
<pre><code>_buildHyperParamsDict(self) -&gt; Dict[str, str]
</code></pre>
<p>In this method you will need to return a dict of strings which adequately describes your model and
its hyperparameters. This string is used to group model files. You have a lot of freedom as to how
to do this, but the recommended approach is to provide short abbreviations of your hyperparameter
names as the dict keys and the corresponding hyperparameter values as the dict values.</p>
<pre><code>_buildGraph(self, numFeatures)
</code></pre>
<p>In this method you will need to build the graph for your model, and return a <code>RegressorTensors</code>
object which contains the appropriate tensors/operations from your graph. This object is the
interface between the graph which you have created in <code>_buildGraph</code> and the training loop
implemented in <code>TFRegressor</code>. </p>
<p>The parameter <code>numFeatures</code> is the number of columns in the parameter <code>X</code> provided to the <code>fit</code>
method.</p>
<pre><code>_restoreGraph(self, graph)
</code></pre>
<p>This method must also return a <code>RegressorTensors</code> object, however the tensors provided to the
constructor of <code>RegressorTensors</code> must be recovered from the provided <code>graph</code> using either
<code>graph.get_tensor_by_name(...)</code> or <code>graph.get_operation_by_name(...)</code>.</p>
<p>For complete examples of all of the above methods, see <code>SKTFModels.BasicRegressor</code>.</p>
<pre><code>_onEpochComplete(self, sess) -&gt; None:
</code></pre>
<p>Unlike the above implementation of this method is optional. This will be called at the end of each
epoch</p>
<pre><code>RegressorTensors(self,
                 X_in,
                 y_in,
                 logits,
                 loss,
                 trainingOp,
                 dropoutKeepProb)
</code></pre>
<p>The constructor of the <code>RegressorTensors</code> object takes several operations from your graph that the
training loop will use while training the model. Each is explained below:</p>
<ul>
<li><code>X_in</code>: The <code>tf.Placeholder</code> for your features</li>
<li><code>y_in</code>: The <code>tf.Placeholder</code> for your labels</li>
<li><code>logits</code>: The output of your graph. The predict method will call <code>logits.eval(...)</code> to produce predictions</li>
<li><code>loss</code>: The loss of your graph. <code>loss.eval(...)</code> will be called to create training and validation loss values to log in tensorboard</li>
<li><code>trainingOp</code>: The operator that should be evaluated for each batch and epoch to train your model</li>
<li><code>dropoutKeepProb</code>: A <code>tf.Placeholder</code> which will be set to the dropout rate during training</li>
</ul>
<h3 id="usage">Usage</h3>
<p>The interface to train models which inherit from <code>TFRegressor</code> is the <code>fit</code> and <code>predict</code> methods.</p>
<pre><code>fit(self, X, y, X_valid, y_valid, numEpochs)
</code></pre>
<p>This will call either <code>_buildGraph</code> or <code>_restoreGraph</code> and then train the model for <code>numEpochs</code>,
using <code>X</code> as the features and <code>y</code> as the labels. A validation set must also be provided in <code>X_valid</code>
and <code>y_valid</code>.</p>
<pre><code>predict(self, X)
</code></pre>
<p>Will perform inference on the given dataset <code>X</code>, returning a numpy array of predictions. Handles an
<code>X</code> that has a large number of parameters by splitting it into batches the same size as specified in
the constructor.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../TrainingHelpers/" class="btn btn-neutral float-right" title="TrainingHelpers">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../SKTFModels/" class="btn btn-neutral" title="SKTFModels"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../SKTFModels/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../TrainingHelpers/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js"></script>
      <script src="../search/require.js"></script>
      <script src="../search/search.js"></script>

</body>
</html>
